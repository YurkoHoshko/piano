# Build Progress Log
Started: 2026-01-19
Feature: Production Hardening & Feature Completeness
Parent Task: 29

## Codebase Patterns
- Ash domains declared in config/config.exs under `:ash_domains` key
- Use `ash.codegen <name>` to generate migrations, then `ash.migrate` to apply
- AshSqlite.Repo requires otp_app: :piano
- Spark.Formatter plugin in .formatter.exs for Ash DSL formatting
- Ash.read with action arguments: `Ash.Query.for_read(Resource, :action, %{arg: value}) |> Ash.read()`
- Ash.create with action arguments: `Ash.Changeset.for_create(Resource, :action, %{attrs}) |> Ash.create!()`
- ExGram uses `use ExGram.Bot, name: __MODULE__` macro - do not add @impl annotations
- Mox requires behaviour module - use @callback in main module, delegate to impl()
- Application.get_env(:app, :impl_key, DefaultImpl) pattern for test injection
- Piano.Logger provides tagged logging: `Logger.info(:tag, "message", key: value)`

---

## 2026-01-19 - US-001: Structured logging with module tagging
Thread: https://ampcode.com/threads/T-019bd967-945a-734d-a15a-6a1bedda60b7
Task ID: 30
- Created `Piano.Logger` module with `log/3`, `info/3`, `error/3`, `warning/3`, `debug/3`
- Format: `[Piano.TAG] message key=value`
- Supports lazy evaluation with function messages
- Updated `Piano.Pipeline.AgentConsumer` to use new logger
- Updated `Piano.Telegram.Bot` to use new logger
- **Learnings for future iterations:**
  - Use `alias Piano.Logger` instead of `require Logger` when switching modules
  - Metadata passed as keyword list, formatted as `key=value` pairs
  - Tags map to prefixes: `:llm` → `Piano.LLM`, `:telegram` → `Piano.Telegram`
---
